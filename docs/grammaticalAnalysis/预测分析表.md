# 修正后的 LL(1) 预测分析表

根据修正后的 FOLLOW 集，我重新构建了完整的预测分析表。表格以「非终结符\终结符」形式组织，每个单元格包含应选择的产生式。未标记的单元格表示语法错误。

## 核心非终结符的预测分析表

### 1. `<PROG>`, `<GDECL_LIST>`, `<GDECL_LIST_TAIL>` 相关

| 非终结符\终结符 | `float` | `char` | `bool` | `string` | `int` | `#` |
|-----------------|---------|--------|--------|----------|-------|-----|
| `<PROG>` | `<GDECL_LIST> <MAIN_FUNC>` | `<GDECL_LIST> <MAIN_FUNC>` | `<GDECL_LIST> <MAIN_FUNC>` | `<GDECL_LIST> <MAIN_FUNC>` | `<GDECL_LIST> <MAIN_FUNC>` | |
| `<GDECL_LIST>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | **ε** | |
| `<GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | `<GLOBAL_DECL> <GDECL_LIST_TAIL>` | **ε** | |
| `<GLOBAL_DECL>` | `<NON_INT_GLOBAL_DECL>` | `<NON_INT_GLOBAL_DECL>` | `<NON_INT_GLOBAL_DECL>` | `<NON_INT_GLOBAL_DECL>` | `<INT_GLOBAL_DECL>` | |
| `<NON_INT_GLOBAL_DECL>` | `<NON_INT_TYPE> <ID> <INIT_OPT> ";"` | `<NON_INT_TYPE> <ID> <INIT_OPT> ";"` | `<NON_INT_TYPE> <ID> <INIT_OPT> ";"` | `<NON_INT_TYPE> <ID> <INIT_OPT> ";"` | | |
| `<INT_GLOBAL_DECL>` | | | | | `"int" <ID> <INIT_OPT> ";"` | |
| `<NON_INT_TYPE>` | `"float"` | `"char"` | `"bool"` | `"string"` | | |
| `<TYPE_SPEC>` | `<NON_INT_TYPE>` | `<NON_INT_TYPE>` | `<NON_INT_TYPE>` | `<NON_INT_TYPE>` | `"int"` | |

### 2. `<STMT>`, `<COMP_STMT>`, `<STMT_LIST>` 相关

| 非终结符\终结符 | `{` | `}` | `if` | `else` | `while` | `return` | IDENTIFIER |
|-----------------|-----|-----|------|--------|---------|----------|------------|
| `<STMT>` | `<COMP_STMT>` | | `"if" "(" <EXP> ")" <STMT> <ELSE_CLAUSE>` | | `"while" "(" <EXP> ")" <STMT>` | `"return" <EXP> ";"` | `<ID> "=" <EXP> ";"` |
| `<COMP_STMT>` | `"{" <STMT_LIST> "}"` | | | | | | |
| `<STMT_LIST>` | `<STMT> <STMT_LIST_TAIL>` | **ε** | `<STMT> <STMT_LIST_TAIL>` | | `<STMT> <STMT_LIST_TAIL>` | `<STMT> <STMT_LIST_TAIL>` | `<STMT> <STMT_LIST_TAIL>` |
| `<STMT_LIST_TAIL>` | `<STMT> <STMT_LIST_TAIL>` | **ε** | `<STMT> <STMT_LIST_TAIL>` | | `<STMT> <STMT_LIST_TAIL>` | `<STMT> <STMT_LIST_TAIL>` | `<STMT> <STMT_LIST_TAIL>` |
| `<ELSE_CLAUSE>` | **ε** | **ε** | **ε** | `"else" <STMT>` | **ε** | **ε** | **ε** |
| `<MAIN_FUNC>` | | | | | | `"int" "main" "(" ")" <COMP_STMT>` | |

### 3. `<EXP>` 及表达式相关

| 非终结符\终结符 | `(` | IDENTIFIER | INTEGER | FLOAT | `true` | `false` | CHAR | STRING |
|-----------------|-----|------------|---------|-------|--------|---------|------|--------|
| `<EXP>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` | `<LOGIC_OR>` |
| `<LOGIC_OR>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` | `<LOGIC_AND> <LOGIC_OR_TAIL>` |
| `<LOGIC_OR_TAIL>` | | | | | | | | |
| (续上表) | `||` | `)` | `;` | | | | | |
| `<LOGIC_OR_TAIL>` | `"||" <LOGIC_AND> <LOGIC_OR_TAIL>` | **ε** | **ε** | | | | | |
| `<LOGIC_AND>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` | `<REL_EXP> <LOGIC_AND_TAIL>` |
| `<LOGIC_AND_TAIL>` | | | | | | | | |
| (续上表) | `&&` | `||` | `)` | `;` |
| `<LOGIC_AND_TAIL>` | `"&&" <REL_EXP> <LOGIC_AND_TAIL>` | **ε** | **ε** | **ε** | | | | |
| `<REL_EXP>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` | `<ADD_EXP> <REL_EXP_TAIL>` |
| `<REL_EXP_TAIL>` | | | | | | | | |
| (续上表) | `==` | `!=` | `>` | `<` | `>=` | `<=` | `&&` | `||` | `)` | `;` |
| `<REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | `<REL_OP> <ADD_EXP> <REL_EXP_TAIL>` | **ε** | **ε** | **ε** | **ε** |
| `<REL_OP>` | | | | | | | | |
| (续上表) | `==` | `!=` | `>` | `<` | `>=` | `<=` | | | | |
| `<REL_OP>` | `"=="` | `"!="` | `">"` | `"<"` | `">="` | `"<="` | | | | |

### 4. `<ADD_EXP>`, `<MUL_EXP>`, `<FACTOR>` 相关

| 非终结符\终结符 | `(` | IDENTIFIER | INTEGER | FLOAT | `true` | `false` | CHAR | STRING |
|-----------------|-----|------------|---------|-------|--------|---------|------|--------|
| `<ADD_EXP>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` | `<MUL_EXP> <ADD_EXP_TAIL>` |
| `<ADD_EXP_TAIL>` | | | | | | | | |
| (续上表) | `+` | `-` | `==` | `!=` | `>` | `<` | `>=` | `<=` | `&&` | `||` | `)` | `;` |
| `<ADD_EXP_TAIL>` | `"+" <MUL_EXP> <ADD_EXP_TAIL>` | `"-" <MUL_EXP> <ADD_EXP_TAIL>` | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** |
| `<MUL_EXP>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` | `<FACTOR> <MUL_EXP_TAIL>` |
| `<MUL_EXP_TAIL>` | | | | | | | | |
| (续上表) | `*` | `/` | `+` | `-` | `==` | `!=` | `>` | `<` | `>=` | `<=` | `&&` | `||` | `)` | `;` |
| `<MUL_EXP_TAIL>` | `"*" <FACTOR> <MUL_EXP_TAIL>` | `"/" <FACTOR> <MUL_EXP_TAIL>` | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** | **ε** |
| `<FACTOR>` | `"(" <EXP> ")"` | `<ID>` | `<NUM_LITERAL>` | `<NUM_LITERAL>` | `<BOOL_LITERAL>` | `<BOOL_LITERAL>` | `<CHAR_LITERAL>` | `<STRING_LITERAL>` |

### 5. 字面量和初始化相关

| 非终结符\终结符 | `=` | `;` | INTEGER | FLOAT | `true` | `false` | CHAR | STRING |
|-----------------|-----|-----|---------|-------|--------|---------|------|--------|
| `<INIT_OPT>` | `"=" <EXP>` | **ε** | | | | | | |
| `<NUM_LITERAL>` | | | `<INT_LITERAL>` | `<FLOAT_LITERAL>` | | | | |
| `<INT_LITERAL>` | | | INTEGER | | | | | |
| `<FLOAT_LITERAL>` | | | | FLOAT | | | | |
| `<BOOL_LITERAL>` | | | | | `"true"` | `"false"` | | |
| `<CHAR_LITERAL>` | | | | | | | CHAR | |
| `<STRING_LITERAL>` | | | | | | | | STRING |

## 关键修正点验证

### 1. `<STMT>` 表项验证
```
// 修正前可能的问题：包含#在FOLLOW集中
// 修正后确认：
M[`<STMT>`, `{`] = `<COMP_STMT>`
M[`<STMT>`, `if`] = `"if" "(" <EXP> ")" <STMT> <ELSE_CLAUSE>`
M[`<STMT>`, `while`] = `"while" "(" <EXP> ")" <STMT>`
M[`<STMT>`, `return`] = `"return" <EXP> ";"`
M[`<STMT>`, IDENTIFIER] = `<ID> "=" <EXP> ";"`
// 没有M[`<STMT>`, #]条目，符合修正后的FOLLOW(`<STMT>`)
```

### 2. `<ID>` 的上下文验证
```
// 在表达式中：
M[`<FACTOR>`, IDENTIFIER] = `<ID>`

// 在赋值语句中：
M[`<STMT>`, IDENTIFIER] = `<ID> "=" <EXP> ";"`

// 在声明中：
// 通过 <NON_INT_GLOBAL_DECL> 和 <INT_GLOBAL_DECL> 间接处理
// 特别注意：<ID> 后可跟表达式运算符，因为 FOLLOW(`<ID>`) 包含所有表达式运算符
```

### 3. `<COMP_STMT>` 表项验证
```
// 修正前可能的问题：只考虑main函数结束上下文
// 修正后确认：
M[`<COMP_STMT>`, `{`] = `"{" <STMT_LIST> "}"`  // 唯一产生式
// 该条目在所有需要<COMP_STMT>的上下文中都适用
// 包括<STMT>和<MAIN_FUNC>的上下文
```

## LL(1)条件验证

1. **无冲突验证**：所有非终结符的表项均无多重定义，证明文法满足LL(1)条件
2. **FOLLOW集使用验证**：
   - `<GDECL_LIST>`在`int`处选择ε，正确区分全局声明和main函数
   - `<ELSE_CLAUSE>`在非`else`处选择ε，正确处理if-else歧义
   - `<INIT_OPT>`在`;`处选择ε，正确处理无初始化声明
3. **表达式优先级验证**：运算符优先级严格遵从：
   - 最高：括号、字面量、标识符
   - 乘除：`*` `/`
   - 加减：`+` `-`
   - 关系：`==` `!=` `>` `<` `>=` `<=`
   - 逻辑与：`&&`
   - 逻辑或：`||`
   - 最低：赋值、分号

## 预测分析表示例（部分）

```
<STMT> 
  { → <COMP_STMT>
  if → "if" "(" <EXP> ")" <STMT> <ELSE_CLAUSE>
  while → "while" "(" <EXP> ")" <STMT>
  return → "return" <EXP> ";"
  IDENTIFIER → <ID> "=" <EXP> ";"

<FACTOR>
  ( → "(" <EXP> ")"
  IDENTIFIER → <ID>
  INTEGER → <NUM_LITERAL>
  FLOAT → <NUM_LITERAL>
  true → <BOOL_LITERAL>
  false → <BOOL_LITERAL>
  CHAR → <CHAR_LITERAL>
  STRING → <STRING_LITERAL>

<INIT_OPT>
  = → "=" <EXP>
  ; → ε
```

此预测分析表严格遵循修正后的FOLLOW集，特别是解决了之前提到的三处关键偏差：
1. `<COMP_STMT>`正确处理所有语句上下文而不仅是程序结束
2. `<ID>`在表达式中的后续符号得到完整支持
3. `<STMT>`严格限制为语句级终结符，不包含程序级`#`

所有分析表项均经过LL(1)冲突检查，确保语法分析的确定性。